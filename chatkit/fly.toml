from fastapi import FastAPI, Response
from fastapi.responses import FileResponse
from fastapi.staticfiles import StaticFiles
from pathlib import Path
import os

app = FastAPI()

# --- Static files (Vite build) ---
# The Dockerfile copies the frontend build to: backend/app/static
# Vite references assets as /assets/... so we mount that directory.
STATIC_DIR = Path(__file__).resolve().parent / "static"
ASSETS_DIR = STATIC_DIR / "assets"

if ASSETS_DIR.exists():
    app.mount("/assets", StaticFiles(directory=str(ASSETS_DIR)), name="assets")

FAVICON = STATIC_DIR / "favicon.ico"
if FAVICON.exists():
    @app.get("/favicon.ico", include_in_schema=False)
    def favicon():
        return FileResponse(str(FAVICON))

# ... other routes ...

@app.api_route("/", methods=["GET", "HEAD"])
def spa_root() -> Response:
    # function body remains unchanged
    ...

@app.api_route("/{full_path:path}", methods=["GET", "HEAD"])
def spa_fallback(full_path: str) -> Response:
    # function body remains unchanged
    ...
